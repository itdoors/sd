{% trans_default_domain 'ListsOrganizationBundle' %}
<script>
    $(document).ready(function(){
        $('#TransferSubmit').on('click', function(){
           var organizations = $('input[name="organizations[]"]:checked').map(function(){
                    return $(this).val();
                }).toArray();
           var departmens = $('input[name="departmens[]"]:checked').map(function(){
                    return $(this).val();
                }).toArray();
            var userId = $('#userTo').val();
            var blockupdate = $('#datatable_ajax');
             $.ajax({
                type: 'POST',
                url: "{{ url('lists_organization_transfer_for_user') }}",
                dataType: 'json',
                data: {
                    departmens: departmens,
                    organizations: organizations,
                    userId: userId
                },
                beforeSend: function() {
                    ITDoorsAjax.blockUI(blockupdate);
                },
                success: function(json) {
                    ITDoorsAjax.unblockUI(blockupdate);
                    if (json.success) {
                        $.ajax({
                        type: 'POST',
                        url: blockupdate.data('url'),
                        success: function(response) {
                            blockupdate.html(response);
                            ITDoorsAjax.unblockUI(blockupdate);
                        }
                    });
                    }else if(json.error){
                        alert(json.error);
                    }
                }
            });
        });
        $('#userTo').select2({
                width: '200px',
                minimumInputLength: 2,
                ajax: {
                    url: '{{ path('sd_common_ajax_user') }}',
                    dataType: 'json',
                    data: function (term, page) {
                        return {
                            query: term
                        };
                    },
                    results: function (data, page) {
                        return {
                            results: data
                        };
                    }
                }
            });
            $('.all-checkbox-organizations').change(function(){
                $('input.organizations').prop('checked', $(this).prop('checked'));
            });
    });
</script>
{% if organizations|length > 0 %}
<div class="table-responsive col-md-12">
    <table class="table table-striped table-bordered table-advance table-hover">
        <thead>
            <tr>
                <th><input type="checkbox" data-name="organizations" class="all-checkbox-organizations"></th>
                <th>{% trans %}ID{% endtrans %} </th>
                <th>{% trans %}Name{% endtrans %} </th>
                <th>{% trans %}Edrpou{% endtrans %} </th>
            </tr>
        </thead>
        <tbody>
            {% for item in organizations %}
                <tr {% if loop.index is odd %}class="color"{% endif %}>
                    <td><input type="checkbox" data-name="organizations" name="organizations[]" class="organizations" value="{{ item.organizationId|e }}"></td>
                    <td><a target="_blank"
                            href="{{ path('lists_sales_admin_organization_show', { id: item.organizationId }) }}">
                            {{ item.organizationId|e }}
                        </a>
                    </td>
                    <td>{{ item.organizationName|e }}</td>
                    <td>{{ item.edrpou|e }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% if departmens|length > 0 %}
<div class="table-responsive col-md-12">
    <table class="table table-striped table-bordered table-advance table-hover">
        <thead>
            <tr>
                <th><input type="checkbox" data-name="departmens" class="all-checkbox"></th>
                <th>{% trans %}MPK{% endtrans %} </th>
                <th>{% trans %}City{% endtrans %} </th>
                <th>{% trans %}Address{% endtrans %} </th>
                <th>{% trans %}Organization{% endtrans %} </th>
            </tr>
        </thead>
        <tbody>
            {% for item in departmens %}
                <tr {% if loop.index is odd %}class="color"{% endif %}>
                    <td><input type="checkbox" name="departmens[]" value="{{ item.id|e }}"></td>
                    <td>{{ item.mpk|e }}</td>
                    <td>{{ item.city|e }}</td>
                    <td>{{ item.address|e }}</td>
                    <td>{{ item.organization|e }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% if organizations|length > 0 or departmens|length > 0 %}
<div class="table-responsive col-md-6">
    <input id="userTo" value="">
    <button type="submit" id="TransferSubmit" name="organizationUserFilterForm[submit]" class="btn blue">{%trans%}Transfer{% endtrans %}</button>
</div>
{% endif %}
