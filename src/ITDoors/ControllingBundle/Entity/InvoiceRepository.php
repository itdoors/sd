<?php

namespace ITDoors\ControllingBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * InvoiceRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class InvoiceRepository extends EntityRepository
{

    /**
     * Returns results for interval future invoice
     *
     * @return mixed[]
     */
    public function findAllOrderedByName()
    {
        return $this->getEntityManager()
                ->createQuery('SELECT i FROM ITDoorsControllingBundle:Invoice i ORDER BY i.date_end ASC')
                ->getResult();
    }

    /**
     * Returns results for interval future invoice
     *
     * @param int $periodmin Description
     * 
     * @param int $periodmax 0 - no restrictions
     *
     * @return mixed[]
     */
    public function getInvoicePeriod($periodmin, $periodmax)
    {
        $query = "
            SELECT
                i
            FROM
                ITDoorsControllingBundle:Invoice i
            WHERE '" . date('Y-m-d') . "' -   i.dateEnd >= '$periodmin'";
        if ($periodmax != 0) {
            $query .= "AND  '" . date('Y-m-d') . "' -   i.dateEnd <= '$periodmax'";
        }
        $query .=" AND ( i.court is NULL OR   i.court = '0' ) ORDER BY i.dateEnd DESC";

        return $this->getEntityManager()
                ->createQuery($query)
                ->getResult();
    }

    /**
     * Returns results for interval future invoice
     *
     * @return mixed[]
     */
    public function getInvoiceCourt()
    {
        $query = "
            SELECT
                i
            FROM
                ITDoorsControllingBundle:Invoice i
            WHERE i.court = '1' ORDER BY i.dateEnd DESC";

        return $this->getEntityManager()
                ->createQuery($query)
                ->getResult();
    }

}
